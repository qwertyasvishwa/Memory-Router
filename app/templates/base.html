<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Memory Router</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            body {
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                margin: 0;
                padding: 0;
                background: #f5f5f7;
            }

            header,
            main {
                max-width: 960px;
                margin: 0 auto;
                padding: 1rem;
            }

            header {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            nav a {
                margin-right: 1rem;
                text-decoration: none;
                color: #0366d6;
            }

            nav a:last-child {
                margin-right: 0;
            }

            .card {
                background: #ffffff;
                border-radius: 8px;
                padding: 1rem 1.5rem;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                margin-bottom: 1rem;
            }

            label {
                display: block;
                font-weight: 600;
                margin-top: 0.5rem;
            }

            input[type="text"],
            textarea,
            select {
                width: 100%;
                padding: 0.5rem;
                margin-top: 0.25rem;
                border-radius: 4px;
                border: 1px solid #d0d7de;
                box-sizing: border-box;
            }

            /* Ensure selects and their options remain readable across themes */
            select,
            select option {
                color: #111;
                /* strong contrast for options */
                background: #ffffff;
            }

            /* Better appearance for multi-select boxes */
            select[multiple] {
                min-height: 120px;
                padding: 0.25rem;
            }

            select[multiple] option {
                padding: 0.25rem 0.5rem;
            }

            textarea {
                min-height: 120px;
                resize: vertical;
            }

            button {
                margin-top: 0.75rem;
                padding: 0.5rem 1.25rem;
                border-radius: 4px;
                border: none;
                background: #0366d6;
                color: white;
                font-weight: 600;
                cursor: pointer;
            }

            button:hover {
                background: #024f9c;
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            th,
            td {
                padding: 0.5rem;
                border-bottom: 1px solid #e1e4e8;
                text-align: left;
                vertical-align: top;
            }

            th {
                background: #f6f8fa;
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.03em;
            }

            .notice {
                margin: 0.75rem 0;
                padding: 0.75rem;
                border-radius: 4px;
                background: #eef6ff;
                color: #024f9c;
            }

            .highlight-row {
                background: #e8f1ff;
            }

            details summary {
                cursor: pointer;
                color: #024f9c;
            }

            code {
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                font-size: 0.85em;
            }

            /* Enhanced Weekly Tracker Styles */
            .filters-section {
                background: #f8f9fa;
                padding: 1rem;
                border-radius: 6px;
                margin-bottom: 1.5rem;
            }

            .summary-bar {
                display: flex;
                gap: 2rem;
                margin-bottom: 1rem;
                flex-wrap: wrap;
            }

            .summary-item {
                font-size: 0.9rem;
            }

            .activity-badge,
            .project-badge {
                background: #e1e4e8;
                padding: 0.2rem 0.5rem;
                border-radius: 3px;
                margin-right: 0.5rem;
                font-size: 0.8rem;
            }

            .activity-badge {
                background: #e8f1ff;
                color: #0366d6;
            }

            .project-badge {
                background: #f0fff4;
                color: #28a745;
            }

            .filter-form {
                border-top: 1px solid #e1e4e8;
                padding-top: 1rem;
            }

            .filter-row {
                display: flex;
                gap: 1rem;
                margin-bottom: 1rem;
                align-items: end;
            }

            .filter-group {
                flex: 1;
            }

            .filter-group label {
                display: block;
                font-size: 0.9rem;
                margin-bottom: 0.25rem;
            }

            .filter-actions {
                display: flex;
                gap: 1rem;
                align-items: center;
            }

            .btn-secondary {
                background: #6c757d;
                color: white;
                padding: 0.5rem 1rem;
                text-decoration: none;
                border-radius: 4px;
            }

            .btn-small {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
                border: 1px solid #d0d7de;
                background: white;
                border-radius: 3px;
                margin-left: 0.5rem;
            }

            .quick-filters {
                margin-left: auto;
            }

            /* Project grouping styles */
            .project-group {
                margin-bottom: 2rem;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
            }

            .project-header {
                background: #f6f8fa;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid #e1e4e8;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .project-stats {
                font-size: 0.8rem;
                color: #586069;
            }

            .toggle-group {
                background: none;
                border: none;
                font-size: 1.2rem;
                cursor: pointer;
                margin-left: auto;
            }

            .entry-card {
                border-bottom: 1px solid #e1e4e8;
                padding: 1rem;
                cursor: pointer;
                transition: background 0.1s;
            }

            .entry-card:hover {
                background: #f8f9fa;
            }

            .entry-header {
                display: flex;
                justify-content: space-between;
                align-items: start;
                margin-bottom: 0.5rem;
            }

            .entry-meta {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .activity-icon {
                font-size: 1.2rem;
            }

            .activity-name {
                font-weight: 600;
                color: #0366d6;
            }

            .entry-date {
                color: #586069;
                font-size: 0.8rem;
            }

            .entry-preview {
                color: #586069;
                font-size: 0.9rem;
            }

            .highlight-entry {
                background: #fff5b4 !important;
                border-left: 3px solid #ffd33d;
            }

            /* Enhanced table styles */
            .enhanced-table {
                font-size: 0.9rem;
            }

            .enhanced-table tr {
                cursor: pointer;
                transition: background 0.1s;
            }

            .enhanced-table tr:hover {
                background: #f8f9fa;
            }

            .date-cell {
                min-width: 80px;
            }

            .date-primary {
                font-weight: 600;
            }

            .date-secondary {
                font-size: 0.8rem;
                color: #586069;
            }

            .activity-cell {
                min-width: 140px;
            }

            .content-cell {
                max-width: 300px;
            }

            .context-line {
                margin-bottom: 0.25rem;
                font-size: 0.85rem;
            }

            .excerpt-line {
                color: #586069;
                font-size: 0.85rem;
            }

            .tasks-cell,
            .overlooked-cell {
                max-width: 250px;
            }

            .task-preview {
                font-size: 0.85rem;
                line-height: 1.3;
            }

            .task-preview.overlooked {
                color: #d73a49;
            }

            .task-count {
                color: #586069;
                font-style: italic;
            }

            .no-tasks {
                color: #959da5;
                font-size: 0.8rem;
            }

            .actions-cell {
                width: 80px;
                text-align: center;
            }

            .action-link {
                margin-right: 0.5rem;
                text-decoration: none;
            }

            .expand-btn {
                background: none;
                border: none;
                cursor: pointer;
                font-size: 1rem;
            }

            .row-details td {
                background: #f8f9fa;
            }

            .expanded-content {
                padding: 1rem;
            }

            .detail-section {
                margin-bottom: 1rem;
            }

            .full-task-list {
                margin: 0.5rem 0 0 1rem;
            }

            .full-task-list.overlooked {
                color: #d73a49;
            }

            .empty-state {
                text-align: center;
                padding: 2rem;
                color: #586069;
            }

            /* Activity-specific row colors */
            .activity-campaign_execution {
                border-left: 3px solid #ff6b6b;
            }

            .activity-product_design {
                border-left: 3px solid #4ecdc4;
            }

            .activity-engineering_delivery {
                border-left: 3px solid #45b7d1;
            }

            .activity-training_enablement {
                border-left: 3px solid #96ceb4;
            }

            .activity-ops_compliance {
                border-left: 3px solid #feca57;
            }

            .activity-performance_reporting {
                border-left: 3px solid #ff9ff3;
            }
        </style>
        <!-- Tom Select (CDN) for improved multi-select UX -->
        <link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
        <script>
            // Enhanced Weekly Tracker JavaScript
            function toggleGroup(projectId) {
                const group = document.getElementById('group-' + projectId);
                const toggle = document.getElementById('toggle-' + projectId);
                if (group.style.display === 'none') {
                    group.style.display = 'block';
                    toggle.textContent = 'âˆ’';
                } else {
                    group.style.display = 'none';
                    toggle.textContent = '+';
                }
            }

            function toggleDetails(entryId) {
                const details = document.getElementById('details-' + entryId);
                if (details.style.display === 'none') {
                    details.style.display = 'block';
                } else {
                    details.style.display = 'none';
                }
            }

            function toggleRowDetails(entryId) {
                const details = document.getElementById('row-details-' + entryId);
                if (details.style.display === 'none' || details.style.display === '') {
                    details.style.display = 'table-row';
                } else {
                    details.style.display = 'none';
                }
            }

            function setDateRange(days) {
                const now = new Date();
                const fromDate = new Date(now.getTime() - (days * 24 * 60 * 60 * 1000));

                const fromInput = document.getElementById('filter_date_from') || document.getElementById('list_date_from');
                const toInput = document.getElementById('filter_date_to') || document.getElementById('list_date_to');

                const fromValue = fromDate.toISOString().split('T')[0];
                const toValue = now.toISOString().split('T')[0];

                if (fromInput) {
                    fromInput.value = fromValue;
                }
                if (toInput) {
                    toInput.value = toValue;
                }
            }

            // Auto-submit form when filters change (optional)
            function setupAutoFilter() {
                const form = document.querySelector('.filter-form');
                if (form) {
                    const inputs = form.querySelectorAll('select, input[type="date"]');
                    inputs.forEach(input => {
                        input.addEventListener('change', () => {
                            // Add a small delay to allow multiple rapid changes
                            clearTimeout(window.filterTimeout);
                            window.filterTimeout = setTimeout(() => {
                                form.submit();
                            }, 500);
                        });
                    });
                }
            }

            // Initialize when page loads
            document.addEventListener('DOMContentLoaded', function () {
                // setupAutoFilter(); // Uncomment if you want auto-filtering

                // Initialize Tom Select on any select marked with data-tom-select
                try {
                    const tsElements = document.querySelectorAll('select[data-tom-select]');
                    tsElements.forEach(el => {
                        // Preserve multiple selection if present
                        new TomSelect(el, {
                            plugins: el.multiple ? ['remove_button'] : [],
                            persist: false,
                            hideSelected: true,
                            closeAfterSelect: !el.multiple,
                            maxItems: el.multiple ? null : 1,
                        });
                    });
                } catch (e) {
                    // If TomSelect isn't available (offline), ignore initialization
                    console.warn('TomSelect init failed', e);
                }
            });
        </script>
    </head>

    <body>
        <header>
            <div>
                <strong>Memory Router</strong>
            </div>
            <nav>
                <a href="/">New entry</a>
                <a href="/entries">Browse entries (session)</a>
                <a href="/drive">Browse SharePoint drive</a>
                <a href="/ledger">Ledger</a>
                <a href="/weekly-tasks">Weekly tasks</a>
                <a href="/enhancements">Enhancements</a>
                <a href="/health">Health</a>
            </nav>
        </header>
        <main>
            {% block content %}{% endblock %}
        </main>
    </body>

</html>
